{% extends '../stela/base.html' %}
{% load static %}

{% block css %}
    <style>
        /* Estilos de Select2 aquí */
        .select2-container .select2-selection--single {
            height: 35px;
        }
        .select2-container .select2-selection--single .select2-selection__rendered {
            line-height: 30px;
        }
        .select2-container .select2-selection--single .select2-selection__arrow {
            height: 48px;
        }
    </style>
    <link rel="stylesheet" href="{% static 'css/error-box.css' %}">
{% endblock %}

{% block scripts %}
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function(){
            // Ya no es necesario aplicar máscaras a #id_nit o #id_nrc,
            // ya que ahora son campos de solo lectura (inputs normales).

            // 1. Teléfono (Máscara sigue siendo útil para el campo editable)
            $('#id_telefono').mask('0000-0000', {
                autoclear: false,
                placeholder: '0000-0000'
            });

            // 2. CIIU (Select2)
            $('#id_ciiu').select2({
                placeholder: "Busque o seleccione su código CIIU",
                allowClear: true,
                width: '100%'
            });
        });
    </script>
{% endblock %}


{% block content %}
{% include 'partials/messages.html' %}
    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-10 col-md-10">
                <div class="card">
                    <div class="card-body">

                        <h5 class="card-title">
                            <i data-lucide="pencil"></i>
                            Editar Empresa: {{ empresa.razon_social }}</h5>


                        <form action="{% url 'editar_empresa' nit=empresa.nit %}" method="post">

                            {% csrf_token %}

                            <div class="row">

                                <div class="col-md-6">

                                    <div class="mb-3">
                                        <i data-lucide="file-text"></i>
                                        <label for="id_nit_display" class="form-label">NIT</label>
                                        <input type="text"
                                               id="id_nit_display"
                                               class="form-control"
                                               value="{{ empresa.nit }}"
                                               readonly>
                                    </div>

                                    <div class="mb-3">
                                        <i data-lucide="file-text"></i>
                                        <label for="id_nrc_display" class="form-label">NRC</label>
                                        <input type="text"
                                               id="id_nrc_display"
                                               class="form-control"
                                               value="{{ empresa.nrc }}"
                                               readonly>
                                    </div>

                                    <div class="mb-3">
                                        <i data-lucide="pencil-line"></i>
                                        {{ form.razon_social.label_tag }}
                                        {{ form.razon_social }}
                                        {% if form.razon_social.errors %}
                                            <div class="text-danger small">{{ form.razon_social.errors }}</div>
                                        {% endif %}
                                    </div>

                                    <div class="mb-3">
                                        <i data-lucide="signpost-big"></i>
                                        {{ form.direccion.label_tag }}
                                        {{ form.direccion }}
                                        {% if form.direccion.errors %}
                                            <div class="text-danger small">{{ form.direccion.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <i data-lucide="factory"></i>
                                        {{ form.ciiu.label_tag }}
                                        {{ form.ciiu }}
                                        {% if form.ciiu.errors %}
                                            <div class="text-danger small">{{ form.ciiu.errors }}</div>
                                        {% endif %}
                                    </div>

                                    <div class="mb-3">
                                        <i data-lucide="mail"></i>
                                        {{ form.email.label_tag }}
                                        {{ form.email }}
                                        {% if form.email.errors %}
                                            <div class="text-danger small">{{ form.email.errors }}</div>
                                        {% endif %}
                                    </div>

                                    <div class="mb-3">
                                        <i data-lucide="phone"></i>
                                        {{ form.telefono.label_tag }}
                                        {{ form.telefono }}
                                        {% if form.telefono.errors %}
                                            <div class="text-danger small">{{ form.telefono.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>

                            </div> <hr>

                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-warning">Guardar Cambios</button>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}